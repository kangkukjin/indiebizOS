# AI Agent 확장

## 목적

프로젝트 안에서 여러 AI 에이전트를 실행하고 관리할 수 있게 합니다.
이 확장이 있어야 에이전트가 실제로 AI와 대화하고, 도구를 사용하고, 다른 에이전트와 협업할 수 있습니다.

## 이 확장이 제공하는 것

- **AI 대화**: 에이전트가 AI 모델과 대화
- **도구 사용**: AI가 tool use로 도구 호출
- **에이전트 간 협업**: call_agent로 다른 에이전트에게 작업 위임
- **다중 프로바이더**: Anthropic, OpenAI, Google, Ollama 등 선택 가능
- **이미지 입력**: 멀티모달 AI 모델 지원

## 이것은 핵심 확장입니다

대부분의 IndieBiz OS 기능은 이 확장에 의존합니다.
에이전트를 사용하려면 반드시 설치해야 합니다.

## 설치 시 필요한 변경사항

### 1. AI 클라이언트 통합

에이전트가 AI API를 호출할 수 있어야 합니다.

지원해야 할 프로바이더:
- **Anthropic Claude**: Messages API, tool use
- **OpenAI GPT**: Chat Completions API, function calling
- **Google Gemini**: GenerativeAI API
- **Ollama**: 로컬 AI (선택적)

각 프로바이더별로:
- API 키 설정
- 모델 선택
- 요청/응답 형식 변환
- 스트리밍 응답 (선택적)

### 2. 도구 시스템

AI가 도구를 호출하고 결과를 받을 수 있어야 합니다.

```
1. AI에게 도구 정의 전달 (tools 파라미터)
2. AI 응답에서 tool_use 블록 감지
3. 해당 도구 함수 실행
4. 결과를 AI에게 다시 전달
5. 최종 응답까지 반복
```

### 3. 에이전트 실행기

각 에이전트를 독립적으로 실행하고 관리해야 합니다.

- 에이전트 시작/중지
- 시스템 프롬프트 구성 (역할 + 공통 설정 + 메모)
- 대화 히스토리 관리
- 외부 채널 연결 (Gmail, Nostr 등 - 해당 확장 설치 시)

### 4. 에이전트 간 통신

에이전트가 다른 에이전트에게 작업을 위임할 수 있어야 합니다.

- `call_agent(agent_name, message)` 도구 제공
- 위임받은 에이전트가 작업 수행
- 결과를 원래 에이전트에게 반환
- 위임 체인 추적 (누가 누구에게 위임했는지)

### 5. 프론트엔드 통합

- 에이전트와 채팅하는 UI
- 에이전트 상태 표시 (실행 중/중지)
- 시작/중지 버튼
- 대화 히스토리 표시

## 참고 구현

이 폴더의 파일들은 Python 기반 구현 예시입니다.

```
base.py           - AIAgent 기본 클래스 (프로바이더 추상화)
agent_runner.py   - 에이전트 실행기 (생명주기 관리)
tool_executor.py  - 도구 실행 로직
providers/        - 프로바이더별 구현
  ├── anthropic.py
  ├── openai.py
  ├── google.py
  └── ollama.py
```

### 의존성 (Python 구현)
```bash
pip install anthropic  # Anthropic
pip install openai     # OpenAI
pip install google-generativeai  # Google
pip install ollama     # Ollama (선택)
```

이 코드를 그대로 사용하지 말고, 현재 시스템에 맞게 구현하세요.

## 설계 고려사항

### 프롬프트 구성

에이전트의 시스템 프롬프트는 여러 부분으로 구성됩니다:
1. 역할 프롬프트 (에이전트별)
2. 공통 설정 (프로젝트 전체)
3. 메모 (에이전트별 추가 지침)

### 컨텍스트 관리

대화가 길어지면 컨텍스트 한도 문제가 생깁니다:
- 오래된 메시지 요약 또는 제거
- 중요한 정보는 메모에 저장
- 토큰 수 모니터링

### 동시성

여러 에이전트가 동시에 실행될 수 있습니다:
- 각 에이전트는 독립적인 스레드/프로세스
- API 호출 동시성 제한 고려
- 에이전트 간 통신은 비동기 처리 권장

## 설치 완료 확인

- [ ] 에이전트가 AI와 대화 가능
- [ ] 설정된 AI 프로바이더(Anthropic/OpenAI/Google)로 연결됨
- [ ] 에이전트가 도구를 호출할 수 있음
- [ ] 에이전트 시작/중지가 동작함
- [ ] 대화 히스토리가 유지됨
