# Gmail 확장

## 목적

AI 에이전트가 Gmail을 통해 외부와 소통할 수 있게 합니다.
설치 후 에이전트는 이메일을 받아 처리하고, 이메일로 응답을 보낼 수 있습니다.

## 이 확장이 제공하는 것

- **이메일 수신**: 에이전트가 받은 이메일을 읽고 처리
- **이메일 발신**: 에이전트가 이메일로 응답 전송
- **원격 접근**: 외출 중에도 이메일로 에이전트에게 지시 가능
- **첨부파일**: 이메일에 파일 첨부 가능

## 설치 시 필요한 변경사항

### 1. 에이전트 설정 UI

에이전트 생성/편집 시 Gmail 채널 옵션이 필요합니다.

- 에이전트 유형 선택에 "외부(External)" 옵션
- 외부 에이전트 선택 시 채널 설정 표시
- 채널 목록에 "Gmail" 옵션 추가
- Gmail 선택 시:
  - Google 계정 연결 버튼
  - OAuth 인증 플로우
  - 연결된 이메일 주소 표시

### 2. Google OAuth 설정

Gmail API를 사용하려면 Google Cloud 설정이 필요합니다.

사용자에게 안내해야 할 사항:
1. Google Cloud Console에서 프로젝트 생성
2. Gmail API 활성화
3. OAuth 2.0 클라이언트 ID 생성 (데스크톱 앱 유형)
4. client_id와 client_secret을 시스템에 입력

또는 시스템 관리자가 미리 설정해둘 수 있습니다.

### 3. 백엔드 - 이메일 폴링

에이전트가 이메일을 받으려면 주기적으로 Gmail을 확인해야 합니다.

- 에이전트 시작 시 폴링 스레드 시작
- 일정 간격으로 새 이메일 확인 (예: 30초)
- 새 이메일 발견 시 에이전트에게 전달
- 에이전트가 처리 후 읽음 표시

### 4. 백엔드 - 이메일 발신

에이전트가 이메일을 보내려면:

- AI에게 send_email 도구 제공
- 도구 호출 시 Gmail API로 이메일 전송
- 첨부파일 지원 (선택적)
- HTML 본문 지원

### 5. 토큰 관리

OAuth 토큰을 안전하게 저장해야 합니다.

- 첫 인증 시 브라우저가 열려 Google 로그인
- 받은 토큰을 안전한 위치에 저장
- 토큰 만료 시 자동 갱신
- 에이전트별로 다른 계정 사용 가능

## 참고 구현

이 폴더의 `gmail.py`는 Python + Google API 클라이언트 구현 예시입니다.

```
gmail.py
├── GmailClient 클래스
│   ├── authenticate()      - OAuth 인증
│   ├── get_unread_messages() - 읽지 않은 이메일
│   ├── get_message()       - 이메일 상세 조회
│   └── send_message()      - 이메일 전송
```

### 의존성 (Python 구현)
```bash
pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
```

이 코드를 그대로 사용하지 말고, 현재 시스템에 맞게 구현하세요.

## 설계 고려사항

### 보안

- OAuth 토큰은 암호화하여 저장 권장
- client_secret은 환경변수나 안전한 설정 파일에
- 사용자에게 권한 범위 명확히 안내

### 사용 시나리오

1. **원격 지시**:
   - 사용자가 외출 중 에이전트에게 이메일로 "오늘 뉴스 정리해줘" 전송
   - 에이전트가 작업 후 결과를 이메일로 회신

2. **알림 수신**:
   - 에이전트가 중요한 일 발생 시 사용자에게 이메일 알림

3. **외부 연동**:
   - 다른 서비스에서 오는 이메일을 에이전트가 처리

### API 제한

- Gmail API에는 일일 할당량이 있음
- 너무 자주 폴링하면 안 됨
- 대용량 첨부파일 전송 시 시간 소요

## 설치 완료 확인

- [ ] 에이전트 설정에 Gmail 채널 옵션이 보임
- [ ] Google 계정 연결(OAuth)이 동작함
- [ ] 에이전트가 새 이메일을 감지함
- [ ] 에이전트가 이메일로 응답을 보낼 수 있음
- [ ] 토큰이 안전하게 저장됨
