# 스케줄러 확장

## 목적

정해진 시간에 작업을 자동으로 실행합니다.
에이전트 없이 백그라운드에서 동작하며, 매일 반복되는 작업을 자동화합니다.
예: 매일 아침 6시에 뉴스 수집, 매일 밤 블로그 백업

## 이 확장이 제공하는 것

- **시간 기반 실행**: "매일 09:00" 같은 스케줄로 작업 실행
- **에이전트 없는 실행**: 사용자 개입 없이 백그라운드 동작
- **작업 관리**: 작업 추가/수정/삭제/활성화/비활성화
- **중복 방지**: 같은 날 같은 작업은 한 번만 실행

## 설치 시 필요한 변경사항

### 1. 스케줄러 엔진

백그라운드에서 시간을 체크하고 작업을 실행하는 엔진이 필요합니다.

```
1. 백그라운드 스레드/프로세스 시작
2. 매분마다 현재 시간 체크
3. 실행할 작업이 있는지 확인
4. 있으면 작업 함수 호출
5. 실행 기록 저장 (중복 방지용)
```

### 2. 작업 저장소

작업 목록을 저장하고 관리해야 합니다.

저장할 정보:
- id: 작업 식별자
- name: 작업 이름
- description: 설명
- time: 실행 시간 (HH:MM 형식)
- enabled: 활성화 여부
- action: 실행할 함수 이름
- last_run: 마지막 실행 시간

저장 위치 예시:
```
data/program_schedule.json
```

### 3. 작업 함수 등록

스케줄러가 호출할 함수들을 등록해야 합니다.

```python
# 예시 구조
actions = {
    "blog_sync": blog_sync_function,
    "news_collect": news_collect_function,
    "backup": backup_function
}
```

새 작업을 추가할 때 action 이름으로 함수를 찾아 실행합니다.

### 4. API 또는 UI

작업을 관리하는 인터페이스가 필요합니다.

필요한 기능:
- 작업 목록 조회
- 새 작업 추가
- 작업 수정
- 작업 삭제
- 활성화/비활성화 토글
- 즉시 실행 (테스트용)

### 5. 시스템 시작 시 자동 시작

IndieBiz OS가 시작될 때 스케줄러도 함께 시작되어야 합니다.

- 백엔드 시작 시 스케줄러 시작
- 종료 시 정리 (graceful shutdown)
- 실행 중 상태 표시

## 설계 고려사항

### 시간대
- 로컬 시간 기준으로 동작
- 서버 시간대 설정 확인

### 에러 처리
- 작업 실패 시 로그 기록
- 다음 실행에는 영향 없음
- 선택적: 실패 시 알림

### 동시 실행
- 여러 작업이 같은 시간에 있으면?
- 순차 실행 또는 병렬 실행 결정

## 참고 구현

이 폴더의 `program_scheduler.py`는 Python 스레드 기반 구현 예시입니다.

```
program_scheduler.py
├── ProgramScheduler 클래스
│   ├── start() / stop()      - 스케줄러 제어
│   ├── add_task()            - 작업 추가
│   ├── update_task()         - 작업 수정
│   ├── delete_task()         - 작업 삭제
│   ├── toggle_task()         - 활성화 토글
│   └── run_task_now()        - 즉시 실행
└── 기본 작업
    └── blog_sync             - 블로그 동기화 예시
```

### 의존성
```bash
# 기본 기능은 추가 설치 필요 없음
# 블로그 동기화 예시 사용 시:
pip install google-generativeai
```

이 코드를 그대로 사용하지 말고, 현재 시스템에 맞게 구현하세요.

## 설치 완료 확인

- [ ] 스케줄러가 백그라운드에서 실행됨
- [ ] 작업을 추가/수정/삭제할 수 있음
- [ ] 지정된 시간에 작업이 자동 실행됨
- [ ] 같은 날 같은 작업은 중복 실행되지 않음
- [ ] 실행 기록을 확인할 수 있음
