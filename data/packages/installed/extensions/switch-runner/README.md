# 스위치 실행기 확장

## 목적

스위치에 저장된 설정만으로 다중 에이전트를 실행합니다.
프로젝트 폴더 없이도 동작하며, 한 번의 클릭으로 복잡한 작업을 시작할 수 있습니다.

## 이 확장이 제공하는 것

- **원클릭 실행**: 스위치 클릭으로 저장된 명령 즉시 실행
- **독립 실행**: 프로젝트 없이 스위치 설정만으로 동작
- **다중 에이전트**: 여러 에이전트가 협업하는 복잡한 작업 가능
- **도구 배분**: 에이전트별로 다른 도구 사용 가능

## 스위치란?

스위치는 자연어 명령을 저장해둔 바로가기입니다.

예시:
- "오늘의 IT 뉴스로 뉴스레터 만들어줘"
- "받은 이메일 확인해서 중요한 것만 요약해줘"
- "블로그에 올릴 글 초안 작성해줘"

스위치를 클릭하면 저장된 명령이 지정된 에이전트에게 전달됩니다.

## 설치 시 필요한 변경사항

### 1. 스위치 저장 구조

스위치 설정을 저장하고 관리해야 합니다.

```json
{
  "id": "switch_001",
  "name": "아침 뉴스레터",
  "command": "오늘의 IT 뉴스로 뉴스레터 만들어줘",
  "config": {
    "agent_name": "집사",
    "common_prompt": "공통 설정...",
    "all_agents": [
      {
        "name": "집사",
        "type": "external",
        "role": "총괄 지휘자",
        "ai": {
          "provider": "gemini",
          "model": "gemini-2.0-flash",
          "api_key": "..."
        }
      },
      {
        "name": "출판",
        "type": "internal",
        "role": "콘텐츠 생성"
      }
    ],
    "tool_assignments": {
      "집사": ["call_agent", "send_email"],
      "출판": ["generate_newspaper", "write_file"]
    }
  }
}
```

### 2. 실행 엔진

스위치를 받아 에이전트를 실행하는 엔진이 필요합니다.

```
1. 스위치 설정 로드
2. 모든 에이전트 초기화
3. 도구 배분 적용
4. 메인 에이전트에게 명령 전달
5. 에이전트 간 위임 처리
6. 최종 결과 반환
```

### 3. 에이전트 간 위임

스위치 모드에서도 에이전트 간 협업이 가능해야 합니다.

- call_agent(target, message) 도구 제공
- 위임 체인 추적
- 결과를 원래 에이전트에게 반환

### 4. 도구 배분 시스템

에이전트별로 사용할 도구를 다르게 설정합니다.

```
tool_assignments:
  집사: [call_agent, send_email]
  출판: [generate_newspaper, write_file]
  대장장이: [execute_code, read_file]
```

### 5. 실행 모드

두 가지 실행 방식을 지원해야 합니다.

**동기 실행 (run):**
- 완료될 때까지 대기
- 결과를 바로 받음

**비동기 실행 (run_async):**
- 백그라운드에서 실행
- 콜백으로 진행 상황 보고
- 스케줄러와 연동 가능

### 6. UI 통합

스위치를 실행하는 인터페이스가 필요합니다.

- 바탕화면에 스위치 아이콘 표시
- 클릭 시 실행
- 실행 중 상태 표시
- 결과 알림

## 설계 고려사항

### 프로젝트와의 차이
- 프로젝트: 대화 히스토리 유지, 지속적 작업
- 스위치: 일회성 실행, 설정만 저장

### 에이전트 재사용
- 내부 에이전트는 AI 설정을 메인 에이전트에서 상속
- 외부 에이전트는 독자적 AI 설정 필요

### 인증 정보
- Gmail, API 키 등은 스위치 config에 저장
- 토큰 갱신 로직 필요

## 참고 구현

이 폴더의 `switch_runner.py`는 Python 기반 구현 예시입니다.

```
switch_runner.py
├── SwitchRunner 클래스
│   ├── run()                    - 동기 실행
│   ├── run_async(callback)      - 비동기 실행
│   ├── _init_all_agents()       - 에이전트 초기화
│   ├── _apply_tool_assignments() - 도구 배분
│   └── call_agent()             - 에이전트 간 위임
└── CLI 인터페이스
    └── python switch_runner.py <switch_id>
```

### 의존성 (Python 구현)
```bash
pip install google-generativeai  # Gemini
pip install anthropic            # Claude
pip install openai               # OpenAI
```

이 코드를 그대로 사용하지 말고, 현재 시스템에 맞게 구현하세요.

## 설치 완료 확인

- [ ] 스위치를 생성하고 설정을 저장할 수 있음
- [ ] 스위치 클릭으로 저장된 명령이 실행됨
- [ ] 여러 에이전트가 협업 가능
- [ ] 에이전트별로 다른 도구 사용 가능
- [ ] 실행 결과를 확인할 수 있음
