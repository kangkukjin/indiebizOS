# System Essentials 사용 가이드

## 도구 선택 가이드

### 파일 작업

| 목적 | 사용할 도구 | 설명 |
|------|------------|------|
| 파일 내용 확인 | `read_file` | 수정 전 반드시 먼저 호출 |
| 새 파일 생성 | `write_file` | 기존 파일이 없을 때만 사용 |
| 파일 전체 교체 | `write_file` | 먼저 read_file로 읽은 후 사용 |
| 파일 부분 수정 | `edit_file` | write_file보다 우선 사용 권장 |

**핵심 규칙:**
- 기존 파일 수정 시 반드시 `read_file` → `edit_file` 순서로 사용
- `write_file`은 전체 덮어쓰기이므로 부분 수정에는 `edit_file` 사용
- 꼭 필요한 경우에만 새 파일 생성 - 기존 파일 편집 우선

### 검색 작업

| 목적 | 사용할 도구 | 설명 |
|------|------------|------|
| 파일명/경로 찾기 | `glob_files` | 패턴 매칭으로 파일 목록 반환 |
| 파일 내용에서 텍스트 찾기 | `grep_files` | 매칭 라인과 라인 번호 반환 |
| 디렉토리 내용 보기 | `list_directory` | 직속 항목만 반환 (비재귀) |

**선택 기준:**
- "이 파일 어디 있지?" → `glob_files` (예: `**/*.py`)
- "이 함수를 어디서 쓰지?" → `grep_files` (예: `pattern='def my_function'`)
- "이 폴더에 뭐가 있지?" → `list_directory`
- 재귀적 파일 탐색 → `glob_files`의 `**` 패턴 사용 (절대 `ls -R` 사용 금지)

---

## run_command 사용 규칙

### 금지/위험 명령어 (사용 금지)

| 명령어 | 위험 이유 | 대안 |
|--------|----------|------|
| `ls -R`, `ls -la -R` | 대용량 출력으로 토큰 초과 | `list_directory` 또는 `glob_files` |
| `find /` | 루트 전체 검색, 출력 폭주 | `glob_files` |
| `cat 대용량파일` | 토큰 초과 | `read_file` |
| `grep`, `rg` | 전용 도구 있음 | `grep_files` |
| `echo >`, `sed`, `awk` | 전용 도구 있음 | `write_file`, `edit_file` |
| 출력 제한 없는 검색 명령 | 토큰 초과 위험 | 전용 검색 도구 사용 |

### 위험 명령어 (approved=true 필요)

| 명령어 | 설명 |
|--------|------|
| `rm`, `rmdir` | 파일/폴더 삭제 |
| `sudo` | 권한 상승 |
| `chmod`, `chown` | 권한 변경 |

### 적합한 사용 예

```
# Git 명령어
git status
git log --oneline -10
git add .
git commit -m "메시지"
git push

# 패키지 관리
npm install
pip install 패키지명
pip list

# 빌드/테스트
npm run build
pytest
python -m pytest tests/

# 프로세스 관리
ps aux | grep 프로세스명
kill PID
```

---

## edit_file 핵심 규칙

1. **반드시 먼저 read_file로 파일 내용 확인**
2. **old_string은 파일 내에서 고유해야 함**
   - 중복되면 에러 발생
   - 중복 시 주변 코드(위아래 줄)를 더 포함하여 고유하게 만들기
3. **들여쓰기(탭/스페이스) 정확히 맞추기**
   - read_file 출력의 들여쓰기를 그대로 복사
   - 탭과 스페이스를 혼용하지 않기

---

## todo_write 사용 가이드

### 사용할 때 (하나라도 해당되면)
- 3개 이상의 구분된 단계가 있는 복잡한 작업
- 사용자가 여러 작업을 요청 (번호 목록, 쉼표 구분)
- 신중한 계획이 필요한 비단순 작업

### 사용하지 않을 때
- 단일하고 직접적인 작업
- 3단계 미만의 사소한 단계로 완료 가능한 작업
- 순수한 대화나 정보 요청

### 상태 관리 규칙
- `pending`: 대기 중
- `in_progress`: 진행 중 (**한 번에 하나만**)
- `completed`: 완료

### 조작 방법 (유일한 todo 도구)
- **항목 추가**: 기존 목록 + 새 항목으로 전체 목록 작성
- **상태 변경**: 해당 항목의 status만 바꿔서 전체 목록 다시 작성
- **항목 삭제**: 해당 항목 제외하고 전체 목록 다시 작성

### 작성 형식
- `content`: 명령형 ("테스트 실행", "파일 수정")
- `activeForm`: 현재진행형 ("테스트 실행 중", "파일 수정 중")

---

## ask_user_question 사용법

### 사용할 때
- 사용자 선호도/요구사항 파악 필요
- 모호한 지시 명확화 필요
- 구현 방식 선택 필요
- 진행 방향에 대한 사용자 의견 필요

### 사용하지 않을 때
- 이미 충분한 정보가 있을 때
- 합리적인 기본 선택이 명확할 때
- 사용자가 이미 명시적 지시를 했을 때

### 작성 규칙
- **선택지 2-4개** 제공
- 권장 옵션은 **첫 번째에 배치**하고 `(권장)` 표시
- `multiSelect=true`로 복수 선택 허용 가능
- 사용자는 항상 "기타"로 직접 입력 가능
- `header`는 최대 12자
- 질문은 1-4개까지 가능

### 주의
- 플랜 모드에서 "계획 진행할까요?"는 `exit_plan_mode` 사용 (ask_user_question 아님)

---

## enter_plan_mode / exit_plan_mode 사용 기준

### 계획 모드 진입 (enter_plan_mode) 시점
1. 새 기능 구현 - 배치 위치, 동작 방식 결정 필요
2. 여러 접근 방식 가능 - 캐싱, 성능 전략 등
3. 기존 동작/구조 변경 - 변경 범위 명확화
4. 아키텍처 결정 - WebSocket vs SSE 등
5. 다중 파일 변경 (2-3개 초과)
6. 요구사항 탐색 필요
7. 사용자 선호도가 중요한 경우

### 계획 모드 없이 바로 진행
- 한두 줄 수정 (오타, 명확한 버그)
- 명확한 요구사항의 단일 함수 추가
- 사용자가 상세하고 구체적 지시를 한 경우
- 순수 조사/탐색 작업

### 계획 모드에서 할 일
1. `glob_files`, `grep_files`, `read_file`로 코드베이스 탐색
2. 기존 패턴과 아키텍처 이해
3. 구현 방안 설계
4. 필요시 `ask_user_question`으로 접근 방식 명확화
5. 준비 완료 시 `exit_plan_mode`로 승인 요청

### exit_plan_mode 사용 조건
- 계획이 완성되고 명확할 때만 사용
- 미해결 질문이 있으면 `ask_user_question` 먼저 사용

---

## save_agent_note / read_agent_note 사용법

### 반드시 메모해야 하는 순간 (하나라도 해당되면 즉시 저장)
- 폴더를 새로 만들었을 때 → 절대 경로 기록
- 백업을 만들었을 때 → 원본 경로와 백업 경로 둘 다 기록
- 파일을 이동/복사했을 때 → 원래 위치와 새 위치 기록
- npm install, 빌드 등 환경을 변경했을 때 → 무엇을 했는지 기록
- 작업 대상 폴더를 처음 확인했을 때 → 절대 경로 기록
- 에러를 해결했을 때 → 원인과 해결법 기록
- 사용자가 중요한 결정을 내렸을 때 → 결정 내용 기록
- 작업이 끝났을 때 → 현재 상태와 다음에 할 일 정리

### 작성 규칙
- **각 항목에 반드시 날짜 포함** (오래된 정보 vs 최신 정보 구분 목적)
- `get_current_time`으로 현재 시간 확인 후 기록
- `append=true`: 기존 메모에 추가
- `append=false`: 전체를 정리해서 덮어쓰기 (메모가 커졌을 때)

### 메모 형식 예시
```
[작업 폴더] /Users/user/HomePages/my-site (01/28 확인)
[백업] /Users/user/HomePages/my-site_backup (01/28 생성)
[환경] npm install 완료, next 16.1.6 (01/27)
[에러 해결] CORS 이슈 → proxy 설정 추가 (01/28)
[상태] hero 섹션 완료 → 다음: features (01/28)
```

### read_agent_note 사용 시점
- **대화 시작 시 반드시 확인** - 이전 대화에서 중요 정보가 있을 수 있음
- 경로가 기억나지 않을 때
- 백업 위치 확인 필요 시

---

## copy_path / move_path / delete_path 주의사항

### copy_path
- 대상 경로에 이미 파일/폴더가 있으면 **덮어씀**
- 매우 큰 폴더 복사는 시간이 걸릴 수 있음
- 상위 디렉토리 자동 생성

### move_path
- 원본이 **삭제됨** (이동이므로)
- 같은 디렉토리 내 이름 변경에도 사용 가능
- 대상 경로에 이미 파일이 있으면 **덮어씀**

### delete_path
- **되돌릴 수 없음** (휴지통으로 이동하지 않음)
- 사용자에게 **반드시 확인 후** 실행
- 폴더 삭제 시 하위 내용 전체 제거
